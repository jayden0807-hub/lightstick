<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Multech Lightshow — Controller (Pro)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#071024;--panel:#0b2230;--accent:#ff5fa8;--muted:#8fb0bb}
    body{margin:0;padding:18px;font-family:Inter, system-ui, Arial;background:var(--bg);color:#fff}
    h2{margin:0 0 12px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .panel{background:var(--panel);padding:12px;border-radius:10px}
    label{font-size:13px;color:var(--muted);display:block;margin-top:8px}
    .row{display:flex;gap:8px;align-items:center;margin-top:8px}
    input[type="color"]{width:48px;height:36px;border:0;background:transparent}
    input[type="number"], input[type="text"]{padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:#031018;color:#fff}
    input[type="range"]{flex:1}
    button{padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:var(--accent);color:#081018}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfe}
    .note{font-size:12px;color:#7fb0bf;margin-left:6px}
    .control-block{display:flex;flex-direction:column;gap:6px}
    .inline{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <h2>Multech Lightshow — Controller (Pro)</h2>

  <div class="grid">
    <div class="panel">
      <label>主颜色（hex）</label>
      <div class="row">
        <input id="color" type="color" value="#ff77aa">
        <input id="colorHex" type="text" value="#ff77aa" style="flex:1">
      </div>

      <div style="margin-top:10px" class="control-block">
        <div><label>常亮（Steady）</label>
          <div class="row">
            <button id="steadyBtn" class="btn-primary">Set Steady</button>
            <button id="clearBtn" class="btn-ghost">Clear All</button>
            <span class="note">Steady 不会停止其它效果</span>
          </div>
        </div>
      </div>
    </div>

    <div class="panel">
      <label>闪烁（单色） — speed (ms)</label>
      <div class="row inline">
        <input id="blinkColor" type="color" value="#ff77aa">
        <input id="blinkSpeedSlider" type="range" min="60" max="2000" value="400">
        <input id="blinkSpeedNum" type="number" min="60" max="2000" value="400" style="width:90px">
        <button id="blinkBtn" class="btn-primary">Start Blink</button>
      </div>

      <label style="margin-top:8px">闪烁（两色交替） — A / B / speed (ms)</label>
      <div class="row inline">
        <input id="blinkA" type="color" value="#ff77aa">
        <input id="blinkB" type="color" value="#0077ff">
        <input id="blink2SpeedSlider" type="range" min="60" max="2000" value="400">
        <input id="blink2SpeedNum" type="number" min="60" max="2000" value="400" style="width:90px">
        <button id="blink2Btn" class="btn-primary">Start 2-color Blink</button>
      </div>

      <label style="margin-top:8px">渐隐渐现（Fade） — duration(ms)</label>
      <div class="row inline">
        <input id="fadeColor" type="color" value="#ff77aa">
        <input id="fadeDurSlider" type="range" min="200" max="10000" value="2200">
        <input id="fadeDurNum" type="number" min="200" max="10000" value="2200" style="width:110px">
        <button id="fadeBtn" class="btn-primary">Play Fade</button>
      </div>
    </div>

    <div class="panel">
      <label>泡泡（Bubble） — color / count / spread</label>
      <div class="row inline">
        <input id="bubbleColor" type="color" value="#9ae0ff">
        <input id="bubbleCountSlider" type="range" min="1" max="80" value="12">
        <input id="bubbleCountNum" type="number" min="1" max="80" value="12" style="width:80px">
      </div>
      <div class="row inline">
        <label style="width:70px">spread</label>
        <input id="bubbleSpreadSlider" type="range" min="0" max="400" value="0">
        <input id="bubbleSpreadNum" type="number" min="0" max="400" value="0" style="width:80px">
        <button id="bubbleBtn" class="btn-primary">Spawn Bubbles</button>
      </div>

      <label style="margin-top:10px">爱心（Heart） — color / size / duration</label>
      <div class="row inline">
        <input id="heartColor" type="color" value="#ff77aa">
        <input id="heartSizeSlider" type="range" min="40" max="300" value="120">
        <input id="heartSizeNum" type="number" min="40" max="300" value="120" style="width:80px">
      </div>
      <div class="row inline">
        <label style="width:70px">duration</label>
        <input id="heartDurSlider" type="range" min="200" max="5000" value="1500">
        <input id="heartDurNum" type="number" min="200" max="5000" value="1500" style="width:110px">
        <button id="heartBtn" class="btn-primary">Send Heart</button>
      </div>

      <label style="margin-top:10px">星星（Star） — color / size / duration</label>
      <div class="row inline">
        <input id="starColor" type="color" value="#fff1a8">
        <input id="starSizeSlider" type="range" min="40" max="300" value="100">
        <input id="starSizeNum" type="number" min="40" max="300" value="100" style="width:80px">
      </div>
      <div class="row inline">
        <label style="width:70px">duration</label>
        <input id="starDurSlider" type="range" min="200" max="5000" value="1500">
        <input id="starDurNum" type="number" min="200" max="5000" value="1500" style="width:110px">
        <button id="starBtn" class="btn-primary">Send Star</button>
      </div>
    </div>

    <div class="panel">
      <label>跑马灯（Marquee） — text / speed(ms) / fontsize</label>
      <div class="row inline">
        <input id="marqText" type="text" placeholder="输入跑马灯文字..." style="flex:1">
        <input id="marqSizeNum" type="number" min="12" max="72" value="28" style="width:80px">
      </div>
      <div class="row inline">
        <input id="marqSpeedSlider" type="range" min="2000" max="40000" value="12000">
        <input id="marqSpeedNum" type="number" min="2000" max="40000" value="12000" style="width:110px">
        <button id="marqBtn" class="btn btn-primary">Send Marquee</button>
      </div>
    </div>
  </div>

  <div style="height:10px"></div>
  <div style="font-size:12px;color:#8fb0bb">说明：每次发送会写入 Firebase `light/action` → 观众端会接收并播放；Steady 不会阻止其它 effect。</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDkvbK-ubU4NKdUXGcj1vKgMNTsb7X2BTg",
      authDomain: "multech-lightshow.firebaseapp.com",
      databaseURL: "https://multech-lightshow-default-rtdb.firebaseio.com",
      projectId: "multech-lightshow",
      storageBucket: "multech-lightshow.firebasestorage.app",
      messagingSenderId: "237208759699",
      appId: "1:237208759699:web:dab1eb9f877811e687cc66",
      measurementId: "G-0YF1GWCWRV"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    console.log('Controller DB ready:', firebaseConfig.databaseURL);

    // shortcut
    const send = (o) => set(ref(db,'light/action'), {...o, ts:Date.now()}).then(()=>console.log('sent',o)).catch(e=>console.error(e));

    // sync color textbox
    const color = document.getElementById('color'), colorHex = document.getElementById('colorHex');
    color.addEventListener('input', ()=> colorHex.value = color.value);
    colorHex.addEventListener('change', ()=> { color.value = colorHex.value });

    // STEADY & CLEAR
    document.getElementById('steadyBtn').onclick = ()=> send({ type:'steady', color: color.value });
    document.getElementById('clearBtn').onclick = ()=> send({ type:'clear' });

    // BLINK single (slider + number sync)
    const blinkColor = document.getElementById('blinkColor');
    const blinkSpeedSlider = document.getElementById('blinkSpeedSlider');
    const blinkSpeedNum = document.getElementById('blinkSpeedNum');
    blinkSpeedSlider.oninput = ()=> blinkSpeedNum.value = blinkSpeedSlider.value;
    blinkSpeedNum.onchange = ()=> blinkSpeedSlider.value = blinkSpeedNum.value;
    document.getElementById('blinkBtn').onclick = ()=> {
      send({ type:'blink', color: blinkColor.value, speed: parseInt(blinkSpeedNum.value||400) });
    };

    // BLINK two-color
    const blinkA = document.getElementById('blinkA'), blinkB = document.getElementById('blinkB');
    const blink2SpeedSlider = document.getElementById('blink2SpeedSlider'), blink2SpeedNum = document.getElementById('blink2SpeedNum');
    blink2SpeedSlider.oninput = ()=> blink2SpeedNum.value = blink2SpeedSlider.value;
    blink2SpeedNum.onchange = ()=> blink2SpeedSlider.value = blink2SpeedNum.value;
    document.getElementById('blink2Btn').onclick = ()=> {
      send({ type:'blink2', colorA: blinkA.value, colorB: blinkB.value, speed: parseInt(blink2SpeedNum.value||400) });
    };

    // FADE
    const fadeColor = document.getElementById('fadeColor'), fadeDurSlider = document.getElementById('fadeDurSlider'), fadeDurNum = document.getElementById('fadeDurNum');
    fadeDurSlider.oninput = ()=> fadeDurNum.value = fadeDurSlider.value;
    fadeDurNum.onchange = ()=> fadeDurSlider.value = fadeDurNum.value;
    document.getElementById('fadeBtn').onclick = ()=> { send({ type:'fade', color: fadeColor.value, duration: parseInt(fadeDurNum.value||2200) }); };

    // BUBBLE
    const bubbleColor = document.getElementById('bubbleColor'), bubbleCountSlider = document.getElementById('bubbleCountSlider'), bubbleCountNum = document.getElementById('bubbleCountNum');
    const bubbleSpreadSlider = document.getElementById('bubbleSpreadSlider'), bubbleSpreadNum = document.getElementById('bubbleSpreadNum');
    bubbleCountSlider.oninput = ()=> bubbleCountNum.value = bubbleCountSlider.value;
    bubbleCountNum.onchange = ()=> bubbleCountSlider.value = bubbleCountNum.value;
    bubbleSpreadSlider.oninput = ()=> bubbleSpreadNum.value = bubbleSpreadSlider.value;
    bubbleSpreadNum.onchange = ()=> bubbleSpreadSlider.value = bubbleSpreadNum.value;
    document.getElementById('bubbleBtn').onclick = ()=> {
      send({ type:'bubble', color: bubbleColor.value, count: parseInt(bubbleCountNum.value||12), spread: parseInt(bubbleSpreadNum.value||0) });
    };

    // HEART
    const heartColor = document.getElementById('heartColor'), heartSizeSlider = document.getElementById('heartSizeSlider'), heartSizeNum = document.getElementById('heartSizeNum');
    const heartDurSlider = document.getElementById('heartDurSlider'), heartDurNum = document.getElementById('heartDurNum');
    heartSizeSlider.oninput = ()=> heartSizeNum.value = heartSizeSlider.value;
    heartSizeNum.onchange = ()=> heartSizeSlider.value = heartSizeNum.value;
    heartDurSlider.oninput = ()=> heartDurNum.value = heartDurSlider.value;
    heartDurNum.onchange = ()=> heartDurSlider.value = heartDurNum.value;
    document.getElementById('heartBtn').onclick = ()=> {
      send({ type:'heart', color: heartColor.value, size: parseInt(heartSizeNum.value||120), duration: parseInt(heartDurNum.value||1500) });
    };

    // STAR
    const starColor = document.getElementById('starColor'), starSizeSlider = document.getElementById('starSizeSlider'), starSizeNum = document.getElementById('starSizeNum');
    const starDurSlider = document.getElementById('starDurSlider'), starDurNum = document.getElementById('starDurNum');
    starSizeSlider.oninput = ()=> starSizeNum.value = starSizeSlider.value;
    starSizeNum.onchange = ()=> starSizeSlider.value = starSizeNum.value;
    starDurSlider.oninput = ()=> starDurNum.value = starDurSlider.value;
    starDurNum.onchange = ()=> starDurSlider.value = starDurNum.value;
    document.getElementById('starBtn').onclick = ()=> {
      send({ type:'star', color: starColor.value, size: parseInt(starSizeNum.value||100), duration: parseInt(starDurNum.value||1500) });
    };

    // MARQUEE
    const marqText = document.getElementById('marqText'), marqSizeNum = document.getElementById('marqSizeNum');
    const marqSpeedSlider = document.getElementById('marqSpeedSlider'), marqSpeedNum = document.getElementById('marqSpeedNum');
    marqSpeedSlider.oninput = ()=> marqSpeedNum.value = marqSpeedSlider.value;
    marqSpeedNum.onchange = ()=> marqSpeedSlider.value = marqSpeedNum.value;
    document.getElementById('marqBtn').onclick = ()=> {
      const t = (marqText.value||'').trim();
      if (!t) return alert('请输入跑马灯文字');
      send({ type:'marquee', text: t, speed: parseInt(marqSpeedNum.value||12000), fontSize: parseInt(marqSizeNum.value||28), color: color.value });
      marqText.value = '';
    };

  </script>
</body>
</html>
