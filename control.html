<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Multech Lightshow — Controller (Final)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#071024;--panel:#0b2230;--accent:#ff5fa8;--muted:#8fb0bb}
    body{margin:0;padding:18px;font-family:Inter,system-ui,Arial;background:var(--bg);color:#fff}
    h2{margin:0 0 12px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .panel{background:var(--panel);padding:12px;border-radius:10px}
    label{font-size:13px;color:var(--muted);display:block;margin-top:8px}
    .row{display:flex;gap:8px;align-items:center;margin-top:8px}
    input[type="color"]{width:48px;height:36px;border:0;background:transparent}
    input[type="number"],input[type="text"]{padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:#031018;color:#fff}
    input[type="range"]{flex:1}
    button{padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:var(--accent);color:#081018}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfe}
    .note{font-size:12px;color:#7fb0bf;margin-left:6px}
  </style>
</head>
<body>
  <h2>Multech Lightshow — Controller (Final)</h2>

  <div class="grid">
    <div class="panel">
      <label>主颜色</label>
      <div class="row">
        <input id="color" type="color" value="#ff77aa">
        <input id="colorHex" type="text" value="#ff77aa" style="flex:1">
      </div>
      <div class="row" style="margin-top:10px">
        <button id="steadyBtn" class="btn-primary">Set Steady</button>
        <button id="clearAllBtn" class="btn-ghost">Clear All</button>
      </div>
    </div>

    <div class="panel">
      <label>闪烁（单色） speed (ms)</label>
      <div class="row">
        <input id="blinkColor" type="color" value="#ff77aa">
        <input id="blinkSpeed" type="number" min="60" max="2000" value="400" style="width:90px">
        <button id="blinkBtn" class="btn-primary">Start Blink</button>
        <button id="clearBlinkBtn" class="btn-ghost">Clear Blink</button>
      </div>

      <label style="margin-top:8px">闪烁（两色） A / B / speed(ms)</label>
      <div class="row">
        <input id="blinkA" type="color" value="#ff77aa">
        <input id="blinkB" type="color" value="#0077ff">
        <input id="blink2Speed" type="number" min="60" max="2000" value="400" style="width:90px">
        <button id="blink2Btn" class="btn-primary">Start 2-color Blink</button>
        <button id="clearBlink2Btn" class="btn-ghost">Clear Blink2</button>
      </div>
    </div>

    <div class="panel">
      <label>泡泡（Bubble） — color / count / spread</label>
      <div class="row">
        <input id="bubbleColor" type="color" value="#9ae0ff">
        <input id="bubbleCount" type="number" min="1" max="200" value="40" style="width:90px">
      </div>
      <div class="row">
        <label style="width:60px">spread</label>
        <input id="bubbleSpread" type="number" min="0" max="800" value="200" style="width:90px">
        <button id="bubbleBtn" class="btn-primary">Spawn Bubbles (Full Page)</button>
        <button id="clearBubbleBtn" class="btn-ghost">Clear Bubbles</button>
      </div>

      <label style="margin-top:10px">爱心（Heart） — single / blast</label>
      <div class="row">
        <input id="heartColor" type="color" value="#ff77aa">
        <input id="heartSize" type="number" min="40" max="300" value="120" style="width:90px">
      </div>
      <div class="row">
        <label style="width:60px">duration</label>
        <input id="heartDur" type="number" min="200" max="5000" value="1500" style="width:90px">
        <button id="heartBtn" class="btn-primary">Send Heart</button>
        <button id="heartBlastBtn" class="btn-primary">Heart Blast</button>
        <button id="clearHeartBtn" class="btn-ghost">Clear Hearts</button>
      </div>

      <label style="margin-top:10px">星星（Star） — single / blast</label>
      <div class="row">
        <input id="starColor" type="color" value="#fff1a8">
        <input id="starSize" type="number" min="40" max="300" value="100" style="width:90px">
      </div>
      <div class="row">
        <label style="width:60px">duration</label>
        <input id="starDur" type="number" min="200" max="5000" value="1500" style="width:90px">
        <button id="starBtn" class="btn-primary">Send Star</button>
        <button id="starBlastBtn" class="btn-primary">Star Blast</button>
        <button id="clearStarBtn" class="btn-ghost">Clear Stars</button>
      </div>
    </div>

    <div class="panel">
      <label>跑马灯（Marquee） — text / speed(ms) / fontsize</label>
      <div class="row">
        <input id="marqText" type="text" placeholder="输入跑马灯文字..." style="flex:1">
        <input id="marqSize" type="number" min="12" max="72" value="28" style="width:90px">
      </div>
      <div class="row">
        <input id="marqSpeed" type="number" min="1000" max="60000" value="12000" style="width:120px">
        <button id="marqBtn" class="btn-primary">Send Marquee</button>
        <button id="clearMarqBtn" class="btn-ghost">Clear Marquee</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDkvbK-ubU4NKdUXGcj1vKgMNTsb7X2BTg",
      authDomain: "multech-lightshow.firebaseapp.com",
      databaseURL: "https://multech-lightshow-default-rtdb.firebaseio.com",
      projectId: "multech-lightshow",
      storageBucket: "multech-lightshow.firebasestorage.app",
      messagingSenderId: "237208759699",
      appId: "1:237208759699:web:dab1eb9f877811e687cc66",
      measurementId: "G-0YF1GWCWRV"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    console.log('Controller DB ready:', firebaseConfig.databaseURL);

    const send = (o) => set(ref(db,'light/action'), {...o, ts:Date.now()}).then(()=>console.log('sent',o)).catch(e=>console.error(e));

    // color sync
    const color = document.getElementById('color'), colorHex = document.getElementById('colorHex');
    color.addEventListener('input', ()=> colorHex.value = color.value);
    colorHex.addEventListener('change', ()=> color.value = colorHex.value);

    document.getElementById('steadyBtn').onclick = ()=> send({ type:'steady', color: color.value });
    document.getElementById('clearAllBtn').onclick = ()=> send({ type:'clear' });

    // blink
    document.getElementById('blinkBtn').onclick = ()=> {
      const c = document.getElementById('blinkColor').value;
      const s = Math.max(60, Math.min(2000, parseInt(document.getElementById('blinkSpeed').value||400)));
      send({ type:'blink', color: c, speed: s });
    };
    document.getElementById('clearBlinkBtn').onclick = ()=> send({ type:'clear_effect', effect:'blink' });

    // blink2
    document.getElementById('blink2Btn').onclick = ()=> {
      const a = document.getElementById('blinkA').value, b = document.getElementById('blinkB').value;
      const s = Math.max(60, Math.min(2000, parseInt(document.getElementById('blink2Speed').value||400)));
      send({ type:'blink2', colorA: a, colorB: b, speed: s });
    };
    document.getElementById('clearBlink2Btn').onclick = ()=> send({ type:'clear_effect', effect:'blink2' });

    // bubbles
    document.getElementById('bubbleBtn').onclick = ()=> {
      const c = document.getElementById('bubbleColor').value;
      const count = Math.max(1, Math.min(200, parseInt(document.getElementById('bubbleCount').value||40)));
      const spread = Math.max(0, Math.min(800, parseInt(document.getElementById('bubbleSpread').value||200)));
      send({ type:'bubble', color: c, count: count, spread: spread });
    };
    document.getElementById('clearBubbleBtn').onclick = ()=> send({ type:'clear_effect', effect:'bubble' });

    // heart single / blast
    document.getElementById('heartBtn').onclick = ()=> {
      const c = document.getElementById('heartColor').value;
      const size = Math.max(40, Math.min(300, parseInt(document.getElementById('heartSize').value||120)));
      const dur = Math.max(200, Math.min(5000, parseInt(document.getElementById('heartDur').value||1500)));
      send({ type:'heart', color: c, size: size, duration: dur });
    };
    document.getElementById('heartBlastBtn').onclick = ()=> {
      const c = document.getElementById('heartColor').value;
      send({ type:'heart_blast', color: c, count: 30 });
    };
    document.getElementById('clearHeartBtn').onclick = ()=> send({ type:'clear_effect', effect:'heart' });

    // star single / blast
    document.getElementById('starBtn').onclick = ()=> {
      const c = document.getElementById('starColor').value;
      const size = Math.max(40, Math.min(300, parseInt(document.getElementById('starSize').value||100)));
      const dur = Math.max(200, Math.min(5000, parseInt(document.getElementById('starDur').value||1500)));
      send({ type:'star', color: c, size: size, duration: dur });
    };
    document.getElementById('starBlastBtn').onclick = ()=> {
      const c = document.getElementById('starColor').value;
      send({ type:'star_blast', color: c, count: 18 });
    };
    document.getElementById('clearStarBtn').onclick = ()=> send({ type:'clear_effect', effect:'star' });

    // marquee
    document.getElementById('marqBtn').onclick = ()=> {
      const txt = (document.getElementById('marqText').value||'').trim();
      if (!txt) return alert('请输入跑马灯文字');
      const speed = Math.max(1000, Math.min(60000, parseInt(document.getElementById('marqSpeed').value||12000)));
      const fs = Math.max(12, Math.min(72, parseInt(document.getElementById('marqSize').value||28)));
      send({ type:'marquee', text: txt, speed: speed, fontSize: fs, color: color.value });
      document.getElementById('marqText').value = '';
    };
    document.getElementById('clearMarqBtn').onclick = ()=> send({ type:'clear_effect', effect:'marquee' });

  </script>
</body>
</html>
